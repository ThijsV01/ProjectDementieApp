@page "/robot"
@inject ISqlBatteryRepository SqlBatteryRepository

<h3>Robot Monitor</h3>

<p>
    Batterijstatus:
    <strong style="color:@BatteryColor">@batteryStatus mV</strong>
</p>

<progress max="12600" value="@batteryStatus"></progress>

<br /><br />

<button class="btn btn-warning" disabled>
    Stop
</button>

@code {
    private int batteryStatus;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

    batteryStatus = await SqlBatteryRepository.GetBatteryStatusInMillivoltsAsync();

    _ = Task.Run(UpdateBatteryLoopAsync);
    }

    private async Task UpdateBatteryLoopAsync()
    {
        while (true)
        {
            batteryStatus = await SqlBatteryRepository.GetBatteryStatusInMillivoltsAsync();
            Console.WriteLine($"Latest battery: {batteryStatus}");
            await InvokeAsync(StateHasChanged); // notify Blazor to rerender
            await Task.Delay(5000);
        }
    }

    private string BatteryColor =>
    batteryStatus < 3300 ? "red" :
    batteryStatus < 8000 ? "orange" :
    "green";
}